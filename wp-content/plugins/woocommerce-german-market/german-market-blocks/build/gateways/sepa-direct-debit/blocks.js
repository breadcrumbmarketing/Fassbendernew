!function(){"use strict";var e=window.wp.element,t=window.wp.i18n,a=window.wc.wcBlocksRegistry,n=window.wp.htmlEntities,r=window.wc.wcSettings,o=window.wc.blocksCheckout;const c=({field:t,setPaymentData:a,paymentData:n})=>{const r=n.hasOwnProperty(t.key)?n[t.key]:"",[c,l]=(0,e.useState)(r),m="german-market-sepa-field "+t.key;let s=t.label;return t.required&&(s+=" *"),(0,e.createElement)(o.ValidatedTextInput,{className:m,id:t.key,label:s,value:c,required:!1,onChange:e=>{((e,t)=>{l(e),a(t,e)})(e,t.key)},errorId:t.key,customValidation:e=>!t.required||""!=e.value||(e.setCustomValidity(t.error_message),!1)})};var l=window.wp.data,m=window.wc.priceFormat;const s=({paymentSettings:t,WooCommerceData:a,setPaymentData:n,paymentData:r})=>{let c=(0,e.createElement)(e.Fragment,null);const{setValidationErrors:s,clearValidationError:i}=(0,l.useDispatch)("wc/store/validation"),d="german-market-sepa-checkbox-mandate",[p,g]=(0,e.useState)(!1),_=a.activePaymentMethod;let u=!1;(0,e.useEffect)((()=>{if("german_market_sepa_direct_debit"===_&&"activated"===t.checkbox_confirmation&&!p)return s({[d]:{message:"error",hidden:!0}}),void(u=!0);i(d)}),[i,d,s,p,_]),(0,e.useEffect)((()=>()=>{i(d)}),[i,d]);const{validationError:y}=(0,l.useSelect)((e=>({validationError:e("wc/store/validation").getValidationError(d)})));if("activated"===t.checkbox_confirmation){let l=t.mandate_text;const s=t.close_text;l=l.replace(/\[creditor_information\]/g,t.creditor_information),l=l.replace(/\[creditor_identifier\]/g,t.creditor_identifier),l=l.replace(/\[creditor_account_holder\]/g,t.creditor_account_holder),l=l.replace(/\[creditor_iban\]/g,t.creditor_iban),l=l.replace(/\[creditor_bic\]/g,t.creditor_bic),l=l.replace(/\[mandate_id\]/g,t.mandate_id),l=l.replace(/\[date\]/g,t.date_info);const i=r.hasOwnProperty("german-market-sepa-holder")?r["german-market-sepa-holder"]:"",_=r.hasOwnProperty("german-market-sepa-iban")?r["german-market-sepa-iban"]:"",b=r.hasOwnProperty("german-market-sepa-bic")?r["german-market-sepa-bic"]:"";l=l.replace(/\[account_holder\]/g,i),l=l.replace(/\[account_iban\]/g,_),l=l.replace(/\[account_bic\]/g,b);const k=a.billing.billingData.address_1,E=a.billing.billingData.postcode,w=a.billing.billingData.city,h=a.billing.billingData.country;l=l.replace(/\[street\]/g,k),l=l.replace(/\[postcode\]/g,E),l=l.replace(/\[city\]/g,w),l=l.replace(/\[country\]/g,h);const v=a.billing.cartTotal.value,D=a.billing.currency,f=(0,m.formatPrice)(v,D);if(l=l.replace(/\[amount\]/g,f),""!=i&&""!=_&&""!=b&&""!=k&&""!=E&&""!=w&&""!=h){!1===y?.hidden&&(u=!0);const a=()=>{document.getElementById("gm-sepa-mandate-preview-text").style.display="none"};c=(0,e.createElement)(e.Fragment,null,(0,e.createElement)(o.CheckboxControl,{id:d,checked:p,onChange:e=>{g(e),((e,a)=>{n(a,e),n(a+"-text",e?t.checkbox_text:"")})(e,d)},hasError:u},(0,e.createElement)("span",{className:"german-market-checkbox",dangerouslySetInnerHTML:{__html:t.checkbox_text}})),(0,e.createElement)("div",{id:"gm-sepa-mandate-preview-text",style:{display:"none"}},(0,e.createElement)("div",{className:"close",onClick:a},s),(0,e.createElement)("div",{className:"gm-sepa-mandate-preview-inner",dangerouslySetInnerHTML:{__html:l}})))}}return c},i=({paymentSettings:t,setPaymentData:a})=>{let n=(0,e.createElement)(e.Fragment,null);const r="german-market-sepa-save-payment-information",[c,l]=(0,e.useState)(!1);return n=(0,e.createElement)(e.Fragment,null,(0,e.createElement)(o.CheckboxControl,{id:r,checked:c,onChange:e=>{l(e),((e,t)=>{a(t,e?"yes":"no")})(e,r)}},(0,e.createElement)("span",{className:"german-market-checkbox",dangerouslySetInnerHTML:{__html:t.save_data_checkbox_text}}))),n};var d=window.wp.components;const p=({paymentSettings:t,WooCommerceData:a,setPaymentData:n,paymentData:r,MaybeFieldsComponent:o})=>{const[c,l]=(0,e.useState)("saved"),m="new"===c?o:(0,e.createElement)(e.Fragment,null),i="saved"===c?(0,e.createElement)(s,{paymentSettings:t,WooCommerceData:a,setPaymentData:n,paymentData:t.user_saved_data}):(0,e.createElement)(e.Fragment,null);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"german-market-sepa-radio-controls"},(0,e.createElement)(d.RadioControl,{selected:c,options:[{label:t.used_stored_data_text+"\n"+t.user_has_saved_data,value:"saved"},{label:t.use_new_data_text,value:"new"}],onChange:e=>{l(e),((e,t)=>{n("german-market-sepa-use-payment-information",e)})(e)}})),i,m)},g=(0,r.getSetting)("german_market_sepa_direct_debit_data",{}),_=(0,t.__)("Sepa Direct Debit","woocommerce-german-market"),u=(0,n.decodeEntities)(g.title)||_,y=g.fields,b=Object.values(y);let k={german_market_sepa_block:"yes"};const E=t=>{const{eventRegistration:a,emitResponse:n}=t,{onPaymentSetup:r}=a;(0,e.useEffect)((()=>{const e=r((async()=>({type:n.responseTypes.SUCCESS,meta:{paymentMethodData:k}})));return()=>{e()}}),[n.responseTypes.ERROR,n.responseTypes.SUCCESS,r,k]);const o=(e,t)=>{k[e]=t};let l=(0,e.createElement)(e.Fragment,null),m=(0,e.createElement)(e.Fragment,null);g.can_save_data&&(m=(0,e.createElement)(i,{paymentSettings:g,setPaymentData:o}));let d=(0,e.createElement)(e.Fragment,null,b.map((t=>(0,e.createElement)(c,{key:t.key,field:t,setPaymentData:o,paymentData:k}))),m,(0,e.createElement)(s,{paymentSettings:g,WooCommerceData:t,setPaymentData:o,paymentData:k}));return!g.can_save_data||g.can_save_data&&""===g.user_has_saved_data?l=d:(k.hasOwnProperty("german-market-sepa-use-payment-information")||(k["german-market-sepa-use-payment-information"]="saved"),l=(0,e.createElement)(e.Fragment,null,(0,e.createElement)(p,{paymentSettings:g,WooCommerceData:t,setPaymentData:o,paymentData:k,MaybeFieldsComponent:d}))),l},w={name:"german_market_sepa_direct_debit",label:(0,e.createElement)((t=>{const{PaymentMethodLabel:a}=t.components;return(0,e.createElement)(a,{text:u})}),null),content:(0,e.createElement)(E,null),edit:(0,e.createElement)(E,null),canMakePayment:()=>!0,ariaLabel:u,supports:{features:g.supports}};(0,a.registerPaymentMethod)(w)}();